# Spec source: https://api.ynab.com/papi/open_api_spec.yaml (public, no auth)
# Update: curl -sS https://api.ynab.com/papi/open_api_spec.yaml -o specs/ynab-v1-openapi.yaml
# Python SDK: https://github.com/ynab/ynab-sdk-python

name: budget_analyst
description: "Personal budget analyst powered by YNAB — answers natural language questions about your finances"

agents:
  - name: analyst
    type: llm
    model: gemini-2.5-flash
    description: "Personal budget analyst with YNAB access — answers finance questions"
    temperature: 0.2
    max_output_tokens: 4096
    tools: [ynab]
    instruction: >
      You are a personal budget analyst with access to the user's YNAB (You Need A Budget) data.
      Answer questions about their budgets, accounts, categories, transactions, and spending patterns.

      WORKFLOW:
      1. ALWAYS start by calling the appropriate budget listing tool to discover available budgets.
         Use the first budget's ID for all subsequent calls unless the user specifies otherwise.
      2. When the user asks about a time period (e.g. "this month"), use since_date based on today's date.
         For "this month", use the first day of the current month.
      3. Present your findings in a clear, human-readable format.

      CRITICAL — TOKEN BUDGET:
      - NEVER call transaction listing without since_date. Unfiltered responses are huge and will fail.

      IMPORTANT NOTES:
      - YNAB amounts are in "milliunits": divide by 1000 to get the real amount (e.g. -50000 = -$50.00).
      - Always convert milliunits to currency format in your responses.
      - Negative amounts = outflows (spending), positive amounts = inflows (income).
      - Use type_filter "uncategorized" or "unapproved" to find transactions needing attention.

      FORMAT:
      - Use currency formatting ($X.XX) for all amounts.
      - Group related data logically (by category, account, date range).
      - Highlight overspending or notable patterns.
      - Be concise but thorough.
    output_key: analysis

orchestration:
  type: react
  agent: analyst
  planner: plan_react

runtime:
  session_service: in_memory
  plugins: [logging]

a2a:
  version: "1.0.0"
  skills:
    - id: budget_analysis
      name: "Budget Analysis"
      description: "Analyze your YNAB budget — spending, balances, categories, and trends"
      tags:
        - finance
        - budget
        - ynab
